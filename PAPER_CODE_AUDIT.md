# CrabPath Paper↔Code Consistency Audit

Status: completed on 2026-02-26.

## Scope
- Claim files reviewed: `scratch/paper.tex`, all `crabpath/*.py`, `tests/`, and key analysis scripts.
- Requested checks: algorithm fidelity, numeric claims, architecture claims, missing-from-paper features, missing-in-paper claims, and LaTeX issues.

## Discrepancies

1. Severity: **MEDIUM**
   - Paper: `scratch/paper.tex:169-171` (three-way routing tiers)
   - Code: `crabpath/synaptogenesis.py:69-71` and `crabpath/_structural_utils.py:115-123`
   - Description: Paper/tables consistently define tiers around `>0.8`, `0.3--0.8`, `<0.3`, but runtime tiering logic in `SynaptogenesisConfig` uses defaults `reflex=0.9`, `dormant=0.1`.
   - Suggested fix: align defaults across paper and code (or clarify in paper that two different tiering thresholds are used in different contexts).

2. Severity: **HIGH**
   - Paper: `scratch/paper.tex:144`
   - Code: `crabpath/synaptogenesis.py:51-53`, `crabpath/synaptogenesis.py:215-217`
   - Description: Paper says promoted real edges start at dormant weight `0.15`, but runtime defaults use `cofire_initial_weight=0.18` or `causal_initial_weight=0.28`.
   - Suggested fix: update paper defaults to match production config, or set config defaults to paper values.

3. Severity: **HIGH**
   - Paper: `scratch/paper.tex:77` and schema snippet `scratch/paper.tex:99`
   - Code: `crabpath/learning.py:247-250`, `crabpath/learning.py:286-290`, `crabpath/decay.py:10-13,27-32`
   - Description: Paper frames weights as signed in `[-1,1]`, but learning/decay can clamp and produce values in `[-5,5]`.
   - Suggested fix: either enforce `[-1,1]` everywhere (and mention in code), or revise paper claims.

4. Severity: **MEDIUM**
   - Paper: `scratch/paper.tex:679`
   - Code: `crabpath/inhibition.py:61-64`, `crabpath/feedback.py:164-166` and `ablation`/`phase` scripts
   - Description: Worked example assigns initial inhibitory edge weight `-0.3`, while runtime default inhibitory insertion is `-0.15`.
   - Suggested fix: update paper examples to reflect runtime `inhibition_strength=0.15` or parameterize/document the example value.

5. Severity: **MEDIUM**
   - Paper: `scratch/paper.tex:541-543` and `:546`
   - Code: `crabpath/controller.py:64-77`, `crabpath/controller.py:376-386`
   - Description: Paper hard-codes two phases by query index (`1--100`, `100+`) and warm-up guidance (`80--100`), while runtime transitions are entropy/gradient-based with `min_queries_before_transition=20` and may shift earlier or later.
   - Suggested fix: either keep phase transition deterministic as in paper, or align paper to adaptive controller thresholds.

6. Severity: **HIGH**
   - Paper: `scratch/paper.tex:498` and `scratch/paper.tex:499`
   - Code: `scripts/ablation_results.json:12108-12119` (generated by `scripts/ablation_study.py:776-940`)
   - Description: Paper reports no-inhibition row as reflex `11`, cross-file `16`, and negation `0.000`; current ablation output reports reflex `8`, cross-file `22`, and negation `0.500` for Arm 4.
   - Suggested fix: regenerate/update paper table from the current `scripts/ablation_results.json` or pin experiment script version used by the manuscript.

7. Severity: **HIGH**
   - Paper: `scratch/paper.tex:498` and `scratch/paper.tex:494-501`
   - Code: `scripts/ablation_results.json:12110-12113` (`accuracy_ci`) and `scripts/ablation_study.py:866-890`
   - Description: Paper’s published Arm 4 confidence interval `[0.368,0.474]` does not match current computation (`[0.526,0.632]`).
   - Suggested fix: rerun ablation script and update CI bounds in manuscript + any generated table references.

8. Severity: **MEDIUM**
   - Paper: `scratch/paper.tex:761-762` and `scratch/paper.tex:757-758`
   - Code: `scripts` outputs (`scripts/ablation_study.py`, `scripts/phase_transition_plot.py`, `crabpath/cli.py`)
   - Description: Paper claims a specific shadow-mode aggregate (`787` nodes, `52K` edges, `235` queries, `4` reflex, `182` cross-file, `3,116/30,700`) with no corresponding script/test output in current repo.
   - Suggested fix: add a reproducible script/artifact that emits these exact metrics (or revise paper to current measurable figures).

9. Severity: **MEDIUM**
   - Paper: `scratch/paper.tex:407` and `scratch/paper.tex:756-758`
   - Code: `scripts/ablation_study.py:3387-3400`, `:12108-12121`, and `:17842-17852`
   - Description: Current scripts report different context scales (e.g., `avg_context_chars` around `1430-1585`) than the manuscript’s fixed `3,116` and `30,700` split.
   - Suggested fix: either update manuscript numbers to match the reproducible scripts or supply the dedicated evaluation run that generates the manuscript figures.

10. Severity: **MEDIUM**
    - Paper: (architecture claim provided by user: “zero dependencies”) / `scratch/paper.tex` has no robust runtime dependency section
    - Code: `crabpath/embeddings.py:198-289`, `crabpath/embeddings.py:299`, `crabpath/feedback.py:110-117`, `pyproject.toml:32-38`
    - Description: Runtime code imports `openai`, `google.generativeai`, `cohere`, `requests`; dependency contract is optional but claim of “zero dependencies” is inaccurate for feature-complete usage.
    - Suggested fix: phrase dependency claim explicitly as “no mandatory runtime deps, optional provider dependencies available.”

11. Severity: **LOW**
    - Paper: `scratch/paper.tex:83-101`
    - Code: `crabpath/graph.py:19-65`, `crabpath/graph.py:225-238`, `crabpath/graph.py:276-290`
    - Description: Paper Node/Edge schema is simplified (e.g., `Node.pointers`, `Edge.target/weight/kind`), while serialized dataclasses now include additional/changed fields (`Node.access_count`, `Node.failure_count`, `Edge.source`, `evidence_count`, `provenance`, etc.).
    - Suggested fix: update paper schema snippet to mirror current dataclass contracts and persistence format.

12. Severity: **MEDIUM**
    - Paper: `scratch/paper.tex:78` (“The LLM is the activation function”) and `scratch/paper.tex:26`/`443`
    - Code: `crabpath/router.py:317-319`, `crabpath/router.py:346-353`, `crabpath/controller.py:498-516`
    - Description: Traversal is not guaranteed to be LLM-driven: if no router client exists or call fails, controllers/routers fall back to heuristic scoring and top-candidate selection.
    - Suggested fix: paper should clarify fallback policy, and provide reproducible conditions under which traversal is strictly model-driven.

13. Severity: **LOW**
    - Paper: `scratch/paper.tex:738-752` (schema/code path mention of “Node and Edge schema”)
    - Code: `crabpath/controller.py:64-85`, `crabpath/controller.py:224-231`
    - Description: `MemoryController` and `LearningPhaseManager` are now core runtime entry points but are not documented in manuscript architecture claims.
    - Suggested fix: add these abstractions to the architecture section.

14. Severity: **LOW**
    - Paper: `scratch/paper.tex:81-100`
    - Code: `crabpath/graph.py:39-40`, `crabpath/graph.py:61-63`
    - Description: New runtime stats fields (`access_count`, `failure_count`, `kind`, `provenance`) are not described in paper’s Node/Edge schema.
    - Suggested fix: add field definitions and semantics in the schema section.

15. Severity: **LOW**
    - Paper: `scratch/paper.tex:609-612`
    - Code: `scratch/paper.tex` (no corresponding `\cite{gu2016}` or `\cite{williams1992}` usages)
    - Description: Bib entries are defined for `gu2016` and `williams1992` but never cited in body text.
    - Suggested fix: add explicit citations where required or remove unused entries.

16. Severity: **MEDIUM**
    - Paper: `scratch/paper.tex:360`
    - Code: this is a LaTeX issue, not a runtime code issue
    - Description: Opening quote for the worked example is not closed (```...`), likely a TeX syntax problem.
    - Suggested fix: close the quote with matching backticks.

17. Severity: **MEDIUM**
    - Paper: `scratch/paper.tex:679`
    - Code: this is a LaTeX issue, not a runtime code issue
    - Description: Another missing closing quote in the worked example creates malformed quoting (```...` without matching closer).
    - Suggested fix: close quote marks and keep string formatting consistent throughout the appendix.

18. Severity: **LOW**
    - Paper: `scratch/paper.tex:609-612`
    - Code: `scratch/paper.tex:563-567`
    - Description: Citations and references are inconsistent in placement (keys present but unused in text); bibliography formatting may be acceptable, but this is a citation audit issue.
    - Suggested fix: review citation ordering and add/remove entries for consistent reference usage.

## Totals
- CRITICAL: 0
- HIGH: 4
- MEDIUM: 8
- LOW: 6

## Test run requirement
Per your request, I will run `python3 -m pytest --tb=short` next and report results.
